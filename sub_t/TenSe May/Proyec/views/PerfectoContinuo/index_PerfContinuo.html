<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MAY Continuo - Misiones Interactivas</title>
    <link rel="stylesheet" href="../../css/style.css" />
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>

<body>
    <!-- HUD de Videojuego -->
    <nav class="hud">
        <div class="hud-logo" aria-label="Logo RTN">RTN</div>
        <div class="hud-user">
            <img src="../../img/avatar.jpg" alt="Avatar de usuario" class="avatar-img" loading="lazy">
            <span id="hud-username">Jugador</span>
        </div>
        <div class="hud-progress">
            <label for="progress-bar" class="sr-only">Progreso de misiones</label>
            <progress id="progress-bar" value="0" max="5"></progress>
            <span id="progress-text">0/5</span>
        </div>
        <div class="hud-score">
            <span>Puntos: <span id="score">0</span></span>
        </div>
    </nav>

    <!-- Chatbox tipo NPC -->
    <div id="avatar-chatbox" aria-live="polite">
        <div id="thought-bubble" style="display:none;"></div>
    </div>

    <!-- ENCABEZADO -->
    <header class="header">
        <div class="logo" aria-label="Logo RTN">RTN</div>
        <h1 class="titulo">MAY Continuo: Misiones Interactivas</h1>
        <p class="subtitulo">隆Completa misiones, gana puntos y desbloquea logros!</p>
    </header>

    <!-- CUERPO PRINCIPAL -->
    <main>
        <section class="misiones" aria-label="Lista de misiones">
            <!-- Misi贸n 1 -->
            <!-- Misi贸n 1 -->
            <article class="mision-card" data-mision="1" tabindex="0" aria-label="Misi贸n 1">
                <div class="mision-header">
                    <img src="../../img/1.png" alt="Imagen misi贸n 1" class="mision-img" loading="lazy">
                    <h2> Misi贸n 1</h2>
                </div>
                <div class="mision-body">
                    <p>Ella quiz谩s haya estado estudiando todo el d铆a.</p>
                    <div class="ejemplo">Ejemplo: <span>She may have been studying all day.</span></div>
                    <div class="mision-interactiva">
                        <label for="respuesta-1">Completa la oraci贸n en ingl茅s:</label>
                        <input type="text" id="respuesta-1" class="mision-input" placeholder="Escribe tu respuesta...">
                        <button class="btn-mision" data-mision="1">Enviar</button>
                        <span class="mision-feedback" id="feedback-1"></span>
                    </div>
                </div>
            </article>

            <!-- Misi贸n 2 -->
            <article class="mision-card" data-mision="2" tabindex="0" aria-label="Misi贸n 2">
                <div class="mision-header">
                    <img src="../../img/2.png" alt="Imagen misi贸n 2" class="mision-img" loading="lazy">
                    <h2> Misi贸n 2</h2>
                </div>
                <div class="mision-body">
                    <p>Ellos quiz谩s hayan estado jugando f煤tbol desde la ma帽ana.</p>
                    <div class="ejemplo">Ejemplo: <span>They may have been playing football since morning.</span></div>
                    <div class="mision-interactiva">
                        <label for="respuesta-2">Completa la oraci贸n en ingl茅s:</label>
                        <input type="text" id="respuesta-2" class="mision-input" placeholder="Escribe tu respuesta...">
                        <button class="btn-mision" data-mision="2">Enviar</button>
                        <span class="mision-feedback" id="feedback-2"></span>
                    </div>
                </div>
            </article>

            <!-- Misi贸n 3 -->
            <article class="mision-card" data-mision="3" tabindex="0" aria-label="Misi贸n 3">
                <div class="mision-header">
                    <img src="../../img/4.png" alt="Imagen misi贸n 3" class="mision-img" loading="lazy">
                    <h2> Misi贸n 3</h2>
                </div>
                <div class="mision-body">
                    <p>T煤 quiz谩s hayas estado trabajando en el proyecto.</p>
                    <div class="ejemplo">Ejemplo: <span>You may have been working on the project.</span></div>
                    <div class="mision-interactiva">
                        <label for="respuesta-3">Completa la oraci贸n en ingl茅s:</label>
                        <input type="text" id="respuesta-3" class="mision-input" placeholder="Escribe tu respuesta...">
                        <button class="btn-mision" data-mision="3">Enviar</button>
                        <span class="mision-feedback" id="feedback-3"></span>
                    </div>
                </div>
            </article>

            <!-- Misi贸n 4 -->
            <article class="mision-card" data-mision="4" tabindex="0" aria-label="Misi贸n 4">
                <div class="mision-header">
                    <img src="../../img/4.png" alt="Imagen misi贸n 4" class="mision-img" loading="lazy">
                    <h2> Misi贸n 4</h2>
                </div>
                <div class="mision-body">
                    <p>Nosotros quiz谩s hayamos estado cocinando toda la tarde.</p>
                    <div class="ejemplo">Ejemplo: <span>We may have been cooking all afternoon.</span></div>
                    <div class="mision-interactiva">
                        <label for="respuesta-4">Completa la oraci贸n en ingl茅s:</label>
                        <input type="text" id="respuesta-4" class="mision-input" placeholder="Escribe tu respuesta...">
                        <button class="btn-mision" data-mision="4">Enviar</button>
                        <span class="mision-feedback" id="feedback-4"></span>
                    </div>
                </div>
            </article>

            <!-- Misi贸n 5 -->
            <article class="mision-card" data-mision="5" tabindex="0" aria-label="Misi贸n 5">
                <div class="mision-header">
                    <img src="../../img/5.png" alt="Imagen misi贸n 5" class="mision-img" loading="lazy">
                    <h2> Misi贸n 5</h2>
                </div>
                <div class="mision-body">
                    <p>l quiz谩s haya estado viendo la pel铆cula desde el principio.</p>
                    <div class="ejemplo">Ejemplo: <span>He may have been watching the movie from the start.</span></div>
                    <div class="mision-interactiva">
                        <label for="respuesta-5">Completa la oraci贸n en ingl茅s:</label>
                        <input type="text" id="respuesta-5" class="mision-input" placeholder="Escribe tu respuesta...">
                        <button class="btn-mision" data-mision="5">Enviar</button>
                        <span class="mision-feedback" id="feedback-5"></span>
                    </div>
                </div>
            </article>

        </section>

        <!-- Logros desbloqueados -->
        <section class="logros" aria-label="Logros desbloqueados">
            <h2> Logros</h2>
            <ul id="lista-logros">
                <li class="logro desbloqueado" id="logro-inicio">隆Bienvenido, aventurero!</li>
                <!-- M谩s logros se agregan din谩micamente -->
            </ul>
        </section>
    </main>

    <!-- PIE DE PGINA -->
    <footer>

        
        <div class="pie-superior">
            <p>P谩gina realizada y preparada mediante pr谩cticas educativas</p>
            <p>#RTN20</p>
            <div class="logo-footer" aria-label="Logo RTN">RTN</div>
            <button class="boton" aria-label="Finalizar" onclick="window.location.href='../Logros/logros.html'">Finalizar</button>
            <address class="contacto">
                <p>Contact us at:</p>
                <p><a href="mailto:rtncontact@gmail.com"> rtncontact@gmail.com</a></p>
                <p> rtn_school</p>
                <p> Ciudad-Colegio</p>
            </address>
        </div>
        <p class="derechos">漏 RTN 2025. All rights reserved.</p>
    </footer>

    <!-- Scripts -->
    <script src="../../js/three.min.js"></script>
    <script src="../../js/GLTFLoader.js"></script>
    <script src="../../js/main.js"></script>
    <script src="../../js/misiones.js"></script>
    <script>
        // Ejemplo de l贸gica JS para misiones interactivas y gamificaci贸n
        const respuestas = [
            "she may have been studying all day",
            "they may have been playing football since morning",
            "you may have been working on the project",
            "we may have been cooking all afternoon",
            "he may have been watching the movie from the start"
        ];

        let score = 0;
        let completadas = 0;
        const total = 5;
        const logros = [
            { id: "logro-1", texto: "隆Primera misi贸n completada!" },
            { id: "logro-2", texto: "隆Mitad de misiones completadas!" },
            { id: "logro-3", texto: "隆Todas las misiones completadas!" }
        ];

        const btnFinalizar = document.querySelector('button[aria-label="Finalizar"]');
        if (btnFinalizar) {
            btnFinalizar.disabled = true;
            btnFinalizar.style.opacity = "0.6";
            btnFinalizar.style.cursor = "not-allowed";
        }

        document.querySelectorAll('.btn-mision').forEach(btn => {
            btn.addEventListener('click', function () {
                const mision = parseInt(this.dataset.mision, 10) - 1;
                const input = document.getElementById(`respuesta-${mision + 1}`);
                const feedback = document.getElementById(`feedback-${mision + 1}`);
                if (!input.value) {
                    feedback.textContent = "隆Escribe tu respuesta!";
                    feedback.className = "mision-feedback error";
                    return;
                }
                // Permitir avanzar aunque la respuesta sea incorrecta
                if (!btn.classList.contains('completada')) {
                    completadas += 1;
                    btn.classList.add('completada');
                    let resultadosPerfContinuo = JSON.parse(localStorage.getItem('resultadosPerfContinuo') || '{}');
                    let resultado = "incorrecta";
                    if (input.value.trim().toLowerCase() === respuestas[mision]) {
                        resultado = "correcta";
                    }
                    resultadosPerfContinuo[`mision${mision+1}`] = resultado;
                    localStorage.setItem('resultadosPerfContinuo', JSON.stringify(resultadosPerfContinuo));
                    if (input.value.trim().toLowerCase() === respuestas[mision]) {
                        score += 100;
                        feedback.textContent = "隆Correcto! +100 puntos";
                        feedback.className = "mision-feedback correcto";
                    } else {
                        feedback.textContent = "Incorrecto, pero puedes avanzar.";
                        feedback.className = "mision-feedback error";
                    }
                    input.disabled = true;
                    btn.disabled = true;
                    document.getElementById('score').textContent = score;
                    document.getElementById('progress-bar').value = completadas;
                    document.getElementById('progress-text').textContent = `${completadas}/${total}`;
                    // Logros
                    if (completadas === 1) desbloquearLogro(logros[0]);
                    if (completadas === 3) desbloquearLogro(logros[1]);
                    if (completadas === total) {
                        desbloquearLogro(logros[2]);
                        setTimeout(() => {
                            alert("隆Misi贸n completa! Has respondido todas las misiones.");
                            if (btnFinalizar) {
                                btnFinalizar.disabled = false;
                                btnFinalizar.style.opacity = "1";
                                btnFinalizar.style.cursor = "pointer";
                            }
                        }, 300);
                    }
                }
            });
        });

        // Cuando desbloqueas un logro
        function desbloquearLogro(logro) {
          if (!document.getElementById(logro.id)) {
            const li = document.createElement('li');
            li.className = "logro desbloqueado";
            li.id = logro.id;
            li.textContent = logro.texto;
            document.getElementById('lista-logros')?.appendChild(li);

            // Guarda el logro en localStorage
            let logrosGuardados = JSON.parse(localStorage.getItem('logrosDesbloqueados') || '[]');
            if (!logrosGuardados.includes(logro.id)) {
              logrosGuardados.push(logro.id);
              localStorage.setItem('logrosDesbloqueados', JSON.stringify(logrosGuardados));
            }
          }
        }
    </script>
</body>

</html>